# siegeNgin — Concept

## 名前の由来

**Siege Engine**（攻城兵器）。概念の壁・言語化の壁を超えて、城壁の向こう側にいるAIと意思疎通するためのツール。

## 解く問題

人間の頭の中には高解像度のビジョンがある。しかし言語化してAIに伝える過程で情報が劣化する。特に「このWebページのこの部分」を伝えるのに、スクリーンショットを撮って、テキストで説明して…という手順は、見えているものをそのまま指させば済む話のはず。

**siegeNginは「指さし」でAIと対話する。**

## アーキテクチャ — 軍事メタファー

```
大将（ユーザー）
  │  指さし + コメントで情報伝達（Chrome拡張）
  │  命令・実行はチャットチャネル（Telegram等）
  ▼
カタパルト（Chrome拡張）
  │  要素情報を城壁の向こうへ射出
  ▼
足軽（伝令）
  │  「届けました🏰」— 判断も実行もしない
  │  外部AIは呼ばない。固定レスポンス。コスト$0
  ▼
本隊（テディ / Claude / ユーザーのAIアシスタント）
  │  Wakeで起きて内容を読む
  │  判断・応答・実行はチャットチャネルで
```

### チャネル分離

- **Chrome拡張（指さし）** = 入力チャネル。「これ見て」
- **チャットチャネル（Telegram等）** = 制御チャネル。「これやって」

指さしは情報伝達のみ。命令・実行はチャットチャネル。完全に分離することで、城門を通るデータが「構造情報だけ」に絞られる。

### なぜ足軽は伝令か？

足軽の仕事は「届けました」の一言だけ。外部AIを呼ばないので：
- API代 $0
- 攻撃面ゼロ（外部にデータが出ない）
- 応答速度は最速（ネットワーク往復のみ）

## 3層モデル（ARCHITECTURE.mdより）

1. **Chat（声）** — 自然言語での会話
2. **Shared View（ホワイトボード）** — 同じページを見ている状態
3. **Pointing（指さし）** — 要素を選んで「これ」と示す行為

人間同士が横並びでモニターを見ながら「ここ」と指さす体験を、AIとの間で再現する。

## 設計思想

### メタファー駆動設計

「攻城兵器」と名付けたことで、足軽・本隊・カタパルトという比喩が自然に生まれ、それがそのままアーキテクチャパターンになった。良いメタファーは設計を導く。

### 城門モデル（セキュリティ）

城壁はガチガチに固める。唯一の通路は城門で、そこを行き来できるのは足軽だけ。

- **城門** = `/api/point` + `/api/response`（認証付き）
- **足軽** = Gemini flash（ステートレス、記憶なし、一次応答のみ）
- **本隊** = AIアシスタント（城内に留まる、チャットチャネルで本対応）
- **通行手形** = Bearer token（`config.json` に設定）

足軽は函谷関の**尹喜**。通行証を持たない者は通さない。仮に城門が破られても、足軽はステートレスなので漏洩するのはその1回のポイントデータだけ。本隊（AIアシスタント本体）は城門を通らず、普段の会話チャネル（Telegram等）で応答する。

#### 通行証フロー（OTP認証）

通行証（ワンタイムパス）は本隊が発行し、チャットチャネル経由で大将にだけ届く。

```
1. 拡張 → /api/point（トークンなし or 不一致）
2. サーバー → 401 + OTP生成 + チャットチャネルに通知
   「🏰 通行証: A7X92K」
3. 拡張 → 入力ダイアログ表示
4. ユーザー → チャットで受け取ったOTPを入力 → 再送信 → 認証成功
```

- **自動発行**: ユーザーが何も覚えなくていい。使おうとしたら届く
- **config.jsonにトークン不要**: 漏洩リスクゼロ
- **ブルートフォース対策**: 5回失敗でロック🔒 → チャットチャネルで通知 + ロック解除もチャットから

#### 二段階通行証

```
OTP（仮通行証）5分で失効 — 入城時の本人確認
    ↓ 認証成功
セッショントークン（正式通行証）— 明示的失効まで有効
```

- **仮通行証（OTP）**: 認証失敗時に自動発行 → チャットに届く → 5分以内に入力
- **正式通行証（セッショントークン）**: OTP通過後に発行。以降のリクエストはこれで認証
- **明示的失効**: チャットからいつでも無効化可能
- **自動失効**: 24時間で自動失効。チャットから延長可能。漏洩時のリスク窓を制限する

#### チャットによる生殺与奪

```
「通行証更新して」 → OTP発行 → 入力 → 新しい正式通行証
「通行証殺して」   → 即無効化 → 拡張は次回アクセスで401
「ロック解除して」 → ロック解除 + 新OTP発行
```

サーバーに一切触らず、チャットチャネルだけで認証の生殺与奪を握る。

> **リスク受容**: チャットチャネルは認証の単一障害点となる。チャネル障害時はSSH等でサーバーに直接アクセスして対応する。個人利用においてはフォールバック機構不要と判断。複数チャネル（Telegram/WhatsApp/Discord等）を持つ運用で実質的に冗長化される。

### 足軽フィルタポリシー

足軽は伝令であり、外部APIを呼ばない。ただし城門を通るデータ自体を最小限にフィルタする。

**城門を通すもの（構造情報）:**
- タグ名（`div`, `h1`, `input` 等）
- CSSセレクタ / XPath（構造的な位置）
- コメント（ユーザーが自分で書いたもの）

**城門を通さないもの（機密を含みうる）:**
- テキスト内容（口座残高、個人情報等が含まれる可能性）
- 属性値（`value`, `data-*` 等にトークンやIDが入りうる）

**本隊だけが全データを見る**。本隊はサーバーローカルの `latest.json` を直接読むため、城門を通らない。

### 壁を溶かす

siegeNginの根底にあるのは「壁を溶かす」という思想。

- 言語化の壁 → 指さしで迂回
- 応答速度の壁 → 足軽で先行
- 認証ページの壁 → ユーザーの実セッションで突破（Chrome拡張）
- ツール導入の壁 → config.json 1つで接続先変更

### 指さしは記号接地（Symbol Grounding）である

言葉だけのコミュニケーションでは、記号（言語）が現実のオブジェクトから浮いている。「左サイドバーの3番目のリンク」と説明するより、クリックして「これ」と示す方が速く、正確で、誤解がない。指さしは記号を現実に接地させる行為であり、言語化の壁を「消す」のではなく「迂回」する。100%の言語化が10%で済むなら、それは革命。

## 公開方針

- Chrome拡張 + サーバー（参照実装）をGitHubで配布
- サーバーはユーザーが自分の環境で動かす
- 接続先は `config.json` で設定
- AIアシスタントは自由（OpenClaw、独自実装、何でも）
- `server.py` はOpenClaw + Gemini足軽の参照実装
