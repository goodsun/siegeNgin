# siegeNgin — Concept

## 名前の由来

**Siege Engine**（攻城兵器）。概念の壁・言語化の壁を超えて、城壁の向こう側にいるAIと意思疎通するためのツール。

## 解く問題

人間の頭の中には高解像度のビジョンがある。しかし言語化してAIに伝える過程で情報が劣化する。特に「このWebページのこの部分」を伝えるのに、スクリーンショットを撮って、テキストで説明して…という手順は、見えているものをそのまま指させば済む話のはず。

**siegeNginは「指さし」でAIと対話する。**

## アーキテクチャ — 軍事メタファー

```
大将（ユーザー）
  │  指さし + コメントで指揮
  ▼
カタパルト（Chrome拡張）
  │  要素情報を城壁の向こうへ射出
  ▼
足軽（Gemini flash / 即応答AI）
  │  1-2秒で一次応答「受け取りました」
  │  ユーザーを待たせない受付係
  ▼
本隊（テディ / Claude / ユーザーのAIアシスタント）
  │  数秒〜数十秒で本対応
  │  深い理解、コンテキスト保持、実行力
  ▼
吹き出し更新（一次→二次応答）
```

### なぜ二段構え？

AIアシスタント（本隊）は高性能だが応答に時間がかかる。ユーザーが「送った→反応ない→不安」になるのを防ぐために、軽量AIが先行して「受け取ったよ」を返す。チャットの既読通知と同じ原理。

## 3層モデル（ARCHITECTURE.mdより）

1. **Chat（声）** — 自然言語での会話
2. **Shared View（ホワイトボード）** — 同じページを見ている状態
3. **Pointing（指さし）** — 要素を選んで「これ」と示す行為

人間同士が横並びでモニターを見ながら「ここ」と指さす体験を、AIとの間で再現する。

## 設計思想

### メタファー駆動設計

「攻城兵器」と名付けたことで、足軽・本隊・カタパルトという比喩が自然に生まれ、それがそのままアーキテクチャパターンになった。良いメタファーは設計を導く。

### 城門モデル（セキュリティ）

城壁はガチガチに固める。唯一の通路は城門で、そこを行き来できるのは足軽だけ。

- **城門** = `/api/point` + `/api/response`（認証付き）
- **足軽** = Gemini flash（ステートレス、記憶なし、一次応答のみ）
- **本隊** = AIアシスタント（城内に留まる、チャットチャネルで本対応）
- **通行手形** = Bearer token（`config.json` に設定）

足軽は函谷関の**尹喜**。通行証を持たない者は通さない。仮に城門が破られても、足軽はステートレスなので漏洩するのはその1回のポイントデータだけ。本隊（AIアシスタント本体）は城門を通らず、普段の会話チャネル（Telegram等）で応答する。

#### 通行証フロー（OTP認証）

通行証（ワンタイムパス）は本隊が発行し、チャットチャネル経由で大将にだけ届く。

```
1. 拡張 → /api/point（トークンなし or 不一致）
2. サーバー → 401 + OTP生成 + チャットチャネルに通知
   「🏰 通行証: A7X92K」
3. 拡張 → 入力ダイアログ表示
4. ユーザー → チャットで受け取ったOTPを入力 → 再送信 → 認証成功
```

- **自動発行**: ユーザーが何も覚えなくていい。使おうとしたら届く
- **config.jsonにトークン不要**: 漏洩リスクゼロ
- **ブルートフォース対策**: 5回失敗でロック🔒 → チャットチャネルで通知 + ロック解除もチャットから

#### 二段階通行証

```
OTP（仮通行証）5分で失効 — 入城時の本人確認
    ↓ 認証成功
セッショントークン（正式通行証）— 明示的失効まで有効
```

- **仮通行証（OTP）**: 認証失敗時に自動発行 → チャットに届く → 5分以内に入力
- **正式通行証（セッショントークン）**: OTP通過後に発行。以降のリクエストはこれで認証
- **明示的失効**: チャットからいつでも無効化可能

#### チャットによる生殺与奪

```
「通行証更新して」 → OTP発行 → 入力 → 新しい正式通行証
「通行証殺して」   → 即無効化 → 拡張は次回アクセスで401
「ロック解除して」 → ロック解除 + 新OTP発行
```

サーバーに一切触らず、チャットチャネルだけで認証の生殺与奪を握る。

### 壁を溶かす

siegeNginの根底にあるのは「壁を溶かす」という思想。

- 言語化の壁 → 指さしで迂回
- 応答速度の壁 → 足軽で先行
- 認証ページの壁 → ユーザーの実セッションで突破（Chrome拡張）
- ツール導入の壁 → config.json 1つで接続先変更

### PRI:130型認知との相性

視覚・空間的把握が突出した認知スタイル（WAIS-IV PRI:130）にとって、「見えているものを言葉にする」コストは特に高い。siegeNginは言語化を最小限にして、視覚的な「指さし」でAIに意図を伝える。GPU脳の出力先としてのAI。

## 公開方針

- Chrome拡張 + サーバー（参照実装）をGitHubで配布
- サーバーはユーザーが自分の環境で動かす
- 接続先は `config.json` で設定
- AIアシスタントは自由（OpenClaw、独自実装、何でも）
- `server.py` はOpenClaw + Gemini足軽の参照実装
